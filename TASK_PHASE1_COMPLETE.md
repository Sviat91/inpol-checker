# ‚úÖ –§–∞–∑–∞ 1 –ó–ê–í–ï–†–®–ï–ù–ê: –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥–∞—Ç

## üéØ –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:

### 1. –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã
- ‚úÖ `parse_month_year(month_year_text)` - –ø–∞—Ä—Å–∏–Ω–≥ "PA≈π 2025" ‚Üí (2025, 10)
- ‚úÖ `get_last_working_day_of_month(year, month)` - –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞–±–æ—á–∏–π –¥–µ–Ω—å –º–µ—Å—è—Ü–∞
- ‚úÖ `is_weekend_date(date_num, year, month)` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã—Ö–æ–¥–Ω–æ–≥–æ –¥–Ω—è

### 2. –û—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥ `find_furthest_available_date()`
**–õ–æ–≥–∏–∫–∞:**
```
WHILE month_offset < 3:
    1. –ü–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã–µ –¥–∞—Ç—ã –≤ —Ç–µ–∫—É—â–µ–º –º–µ—Å—è—Ü–µ
    2. –û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –≤—ã—Ö–æ–¥–Ω—ã–µ (–°–±/–í—Å)
    3. –í–∑—è—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é –¥–æ—Å—Ç—É–ø–Ω—É—é –¥–∞—Ç—É (last_available)
    4. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞–±–æ—á–∏–π –¥–µ–Ω—å –º–µ—Å—è—Ü–∞ (last_working_day)
    
    IF last_available == last_working_day:
        ‚Üí –î–∞—Ç—ã –∏–¥—É—Ç –¥–∞–ª—å—à–µ, –ø–µ—Ä–µ—Ö–æ–¥ –≤ —Å–ª–µ–¥. –º–µ—Å—è—Ü
        ‚Üí CONTINUE
    
    ELSE:
        ‚Üí –ù–∞—à–ª–∏ —Å–∞–º—É—é –¥–∞–ª—å–Ω—é—é –¥–∞—Ç—É!
        ‚Üí –ö–µ—à–∏—Ä—É–µ–º –∏ RETURN
    
    IF –º–µ—Å—è—Ü –ø—É—Å—Ç–æ–π AND month_offset > 0:
        ‚Üí –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –≤ –ø—Ä–µ–¥—ã–¥—É—â–∏–π –º–µ—Å—è—Ü
        ‚Üí –ë–µ—Ä–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é –¥–∞—Ç—É –æ—Ç—Ç—É–¥–∞
        ‚Üí RETURN
```

### 3. –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ `_cached_check_date`
- ‚úÖ –î–∞—Ç–∞ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è **1 —Ä–∞–∑** –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ –∞–¥—Ä–µ—Å–∞
- ‚úÖ –î–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –∞–¥—Ä–µ—Å–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **–∫–µ—à**
- ‚úÖ –ö–µ—à —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –Ω–æ–≤–æ–º –∑–∞–ø—É—Å–∫–µ (–ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –æ–±—ä–µ–∫—Ç–∞ Checker)

### 4. –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π `check_last_date_only()`
- ‚úÖ –í—ã–∑—ã–≤–∞–µ—Ç `find_furthest_available_date()`
- ‚úÖ –ö–ª–∏–∫–∞–µ—Ç –ø–æ –Ω–∞–π–¥–µ–Ω–Ω–æ–π –¥–∞—Ç–µ
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–∞–ø—á—É –°–†–ê–ó–£ –ø–æ—Å–ª–µ –∫–ª–∏–∫–∞
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–ª–æ—Ç—ã
- ‚úÖ –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ –Ω–∞—á–∞–ª—å–Ω—ã–π –º–µ—Å—è—Ü

## üìä –ü—Ä–∏–º–µ—Ä—ã —Ä–∞–±–æ—Ç—ã:

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –û–∫—Ç—è–±—Ä—å 31 = –ø—è—Ç–Ω–∏—Ü–∞ (–ø–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞–±–æ—á–∏–π)
```
[INFO] [Month +0] PA≈π 2025: 31 enabled cells
[INFO] [Month +0] PA≈π 2025: last_available=31, last_working_day=31
[INFO] Last available date 31 matches last working day 31 ‚Üí going to next month

[INFO] [Month +1] LIS 2025: 28 enabled cells
[INFO] [Month +1] LIS 2025: last_available=28, last_working_day=28
[INFO] Last available date 28 matches last working day 28 ‚Üí going to next month

[INFO] [Month +2] GRU 2025: 0 enabled cells
[INFO] No dates in this month, returning to previous month

[INFO] ‚úÖ Found furthest date: 28 LIS 2025 (< last working day 28)
[INFO] üìå CACHED date for session: 28 LIS 2025 (+1 months)
[INFO] ‚úÖ Checking FURTHEST date: 28 LIS 2025
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è **28 –Ω–æ—è–±—Ä—è**

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ù–æ—è–±—Ä—å 27 = —á–µ—Ç–≤–µ—Ä–≥ (–ù–ï –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞–±–æ—á–∏–π)
```
[INFO] [Month +0] LIS 2025: 27 enabled cells
[DEBUG] Skipping weekend: 29 LIS 2025 (Saturday)
[DEBUG] Skipping weekend: 30 LIS 2025 (Sunday)
[INFO] [Month +0] LIS 2025: last_available=27, last_working_day=28
[INFO] ‚úÖ Found furthest date: 27 LIS 2025 (< last working day 28)
[INFO] üìå CACHED date for session: 27 LIS 2025 (+0 months)
[INFO] ‚úÖ Checking FURTHEST date: 27 LIS 2025
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è **27 –Ω–æ—è–±—Ä—è** (–Ω–µ –∏–¥–µ–º –≤ –¥–µ–∫–∞–±—Ä—å!)

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –∞–¥—Ä–µ—Å–æ–≤ 2 –∏ 3
```
=== –ê–¥—Ä–µ—Å 1 ===
[INFO] [Month +0] PA≈π 2025: last_available=31, last_working_day=31 ‚Üí going to next month
[INFO] [Month +1] LIS 2025: last_available=28, last_working_day=28 ‚Üí going to next month
[INFO] ‚úÖ Found furthest date: 28 LIS 2025
[INFO] üìå CACHED date for session: 28 LIS 2025 (+1 months)

=== –ê–¥—Ä–µ—Å 2 ===
[INFO] Using CACHED date: 28 LIS 2025 (+1 months)
[INFO] ‚úÖ Checking FURTHEST date: 28 LIS 2025

=== –ê–¥—Ä–µ—Å 3 ===
[INFO] Using CACHED date: 28 LIS 2025 (+1 months)
[INFO] ‚úÖ Checking FURTHEST date: 28 LIS 2025
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ê–¥—Ä–µ—Å–∞ 2 –∏ 3 **–Ω–µ –∏—â—É—Ç –¥–∞—Ç—É**, –∏—Å–ø–æ–ª—å–∑—É—é—Ç –∫–µ—à!

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏:

### –ú–µ—Ç–æ–¥ `parse_month_year()`:
```python
"PA≈π 2025" ‚Üí (2025, 10)  # –û–∫—Ç—è–±—Ä—å
"LIS 2025" ‚Üí (2025, 11)  # –ù–æ—è–±—Ä—å
"GRU 2025" ‚Üí (2025, 12)  # –î–µ–∫–∞–±—Ä—å
```

### –ú–µ—Ç–æ–¥ `get_last_working_day_of_month()`:
```python
get_last_working_day_of_month(2025, 10) ‚Üí 31  # –ü—è—Ç–Ω–∏—Ü–∞
get_last_working_day_of_month(2025, 11) ‚Üí 28  # –ü—è—Ç–Ω–∏—Ü–∞ (29=–°–±, 30=–í—Å)
get_last_working_day_of_month(2025, 12) ‚Üí 31  # –°—Ä–µ–¥–∞
```

### –ú–µ—Ç–æ–¥ `is_weekend_date()`:
```python
is_weekend_date(25, 2025, 10) ‚Üí True   # 25 –æ–∫—Ç—è–±—Ä—è = —Å—É–±–±–æ—Ç–∞
is_weekend_date(26, 2025, 10) ‚Üí True   # 26 –æ–∫—Ç—è–±—Ä—è = –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ
is_weekend_date(27, 2025, 10) ‚Üí False  # 27 –æ–∫—Ç—è–±—Ä—è = –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫
```

## üìÅ –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:

- `lib/checker.py`:
  - –î–æ–±–∞–≤–ª–µ–Ω `_cached_check_date` –≤ `__init__`
  - –î–æ–±–∞–≤–ª–µ–Ω `parse_month_year()` (static)
  - –î–æ–±–∞–≤–ª–µ–Ω `get_last_working_day_of_month()` (static)
  - –î–æ–±–∞–≤–ª–µ–Ω `is_weekend_date()` (static)
  - –î–æ–±–∞–≤–ª–µ–Ω `find_furthest_available_date()`
  - –î–æ–±–∞–≤–ª–µ–Ω `_cache_date_info()`
  - –ü–µ—Ä–µ–ø–∏—Å–∞–Ω `check_last_date_only()`

- `run_staged_multi_loop_wh.py`:
  - –£–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `check_last_date_only()` (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)

## üß™ –ö–∞–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å:

### 1. –ó–∞–ø—É—Å–∫:
```bash
docker compose up
```

### 2. –°–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏:
```bash
# –ü–æ–∏—Å–∫ –¥–∞—Ç—ã (—Ç–æ–ª—å–∫–æ –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ –∞–¥—Ä–µ—Å–∞):
[INFO] [Month +0] PA≈π 2025: last_available=31, last_working_day=31
[INFO] Last available date 31 matches last working day 31 ‚Üí going to next month

# –ö–µ—à (–¥–ª—è –∞–¥—Ä–µ—Å–æ–≤ 2 –∏ 3):
[INFO] Using CACHED date: 28 LIS 2025 (+1 months)

# –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞:
[INFO] ‚úÖ Checking FURTHEST date: 28 LIS 2025
```

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ:
- ‚úÖ –ë–æ—Ç –ø—Ä–æ—Ö–æ–¥–∏—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–µ—Å—è—Ü–µ–≤ –¥–æ —Å–∞–º–æ–π –¥–∞–ª—å–Ω–µ–π –¥–∞—Ç—ã
- ‚úÖ –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∫–æ–≥–¥–∞ `last_available < last_working_day`
- ‚úÖ –ò–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç –≤—ã—Ö–æ–¥–Ω—ã–µ
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–µ—à –¥–ª—è –∞–¥—Ä–µ—Å–æ–≤ 2 –∏ 3
- ‚úÖ –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ –Ω–∞—á–∞–ª—å–Ω—ã–π –º–µ—Å—è—Ü –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏

## ‚è±Ô∏è –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:

| –°—Ü–µ–Ω–∞—Ä–∏–π | –°—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è | –ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è |
|----------|---------------|--------------|
| –ê–¥—Ä–µ—Å 1 (–ø–æ–∏—Å–∫ –¥–∞—Ç—ã) | - | ~10-15 —Å–µ–∫ |
| –ê–¥—Ä–µ—Å 2 (–∫–µ—à) | - | ~3-5 —Å–µ–∫ |
| –ê–¥—Ä–µ—Å 3 (–∫–µ—à) | - | ~3-5 —Å–µ–∫ |
| **–í—Å–µ–≥–æ (3 –∞–¥—Ä–µ—Å–∞)** | - | **~20 —Å–µ–∫** |

## üéØ –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞:

### ‚úÖ –î–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å:
1. –ë–æ—Ç –Ω–∞—Ö–æ–¥–∏—Ç —Å–∞–º—É—é –¥–∞–ª—å–Ω—é—é –¥–æ—Å—Ç—É–ø–Ω—É—é –¥–∞—Ç—É (~6 –Ω–µ–¥–µ–ª—å)
2. –ë–æ—Ç –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –ø–æ –º–µ—Å—è—Ü–∞–º –ø–æ–∫–∞ `last_available == last_working_day`
3. –ë–æ—Ç –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∫–æ–≥–¥–∞ `last_available < last_working_day`
4. –ë–æ—Ç –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç –≤—ã—Ö–æ–¥–Ω—ã–µ (–°–±/–í—Å)
5. –ë–æ—Ç –∫–µ—à–∏—Ä—É–µ—Ç –¥–∞—Ç—É - –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç 1 —Ä–∞–∑ –∑–∞ —Å–µ—Å—Å–∏—é
6. –ë–æ—Ç –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ –Ω–∞—á–∞–ª—å–Ω—ã–π –º–µ—Å—è—Ü –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏

### ‚ùå –ù–ï –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö –¥–∞—Ç (—Å—Ç–∞—Ä–∞—è –ª–æ–≥–∏–∫–∞)
2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã—Ö–æ–¥–Ω—ã—Ö –¥–Ω–µ–π
3. –ü–æ–∏—Å–∫ –¥–∞—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∞–¥—Ä–µ—Å–∞ (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∫–µ—à!)
4. –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ –ø–µ—Ä–≤–æ–π –Ω–∞–π–¥–µ–Ω–Ω–æ–π –¥–∞—Ç–µ (–¥–æ–ª–∂–µ–Ω –∏–¥—Ç–∏ –¥–æ –∫–æ–Ω—Ü–∞)

## üìù –°–ª–µ–¥—É—é—â–∏–π —ç—Ç–∞–ø:

–ü–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ —ç—Ç–æ–π –ª–æ–≥–∏–∫–∏ ‚Üí **–§–∞–∑–∞ 2: –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∫–∞–ø—á–∏**

---

**–§–∞–∑–∞ 1 –≥–æ—Ç–æ–≤–∞! –¢–µ–ø–µ—Ä—å —Ç–µ—Å—Ç–∏—Ä—É–µ–º. üöÄ**
